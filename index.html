<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validação de Certificado</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="Inicio">
        <div class="Governo">
            <a href="https://www.gov.br/pt-br" class=" links">Portal do Governo Brasileiro</a>
        </div>
        <section class="Inicio caixa">
            <img class="logo__depa" src="/img/DEPA.png" alt="Símbolo da DEPA">
            <div class="Inicio  Informação">
                <p class="Inicio__texto__menor">Ministério da Defesa - Exército Brasileiro - DECEx</p>
                <h2 class="Inicio__titulo">Diretoria de Educação Preparatória e Assistencial</h2>
                <p class="Inicio__texto__maior">"SISTEMA COLÉGIO MILITAR DO BRASIL"</p>
            </div>
        </section>  
    </header>

    <nav class="menu">
        <ul class="menu__lista">
            <li><a href="https://www.depa.eb.mil.br/perguntas-frequentes" class="links">Perguntas frequentes</a></li>
            <li><a href="https://www.depa.eb.mil.br/fale-conosco" class="links">Fale Conosco</a></li>
            <li><a href="https://avadepa.cmm.eb.mil.br/" class="links">AVA</a></li>
            <li><a href="https://www.depa.eb.mil.br/link" class="links">Link</a></li>
            <li><a href="https://www.eb.mil.br/" class="links">Exército</a></li>
            <li><a href="https://www.eb.mil.br/web/rp/junte-se-a-nos" class="links">Junte-se a nós</a></li>
        </ul>
    </nav>

    <section class="dicas">
        <h1 class="dicas__titulo">Validação de <span>Documentos</span></h1>
        <p class="dicas__texto">Preencha apenas os campos correspondentes ao documento que você deseja validar. Não é necessário fazer login.</p>
        <p class="dicas__dicas">Dicas:</p>
        <p class="dicas__texto">• Atenção para não confundir o número "1" com a letra "L" minúscula ou a letra "o" com o número zero.</p>
        <p class="dicas__texto">• Atenção ao campo CPF, insira somente os 11 dígitos numéricos que deseja consultar.</p>
        <p class="dicas__texto">• Atenção Insira o Nome Completo do Aluno.</p>
    </section>

    <form id="formFiltro">
        <label for="cpf">Informe o CPF:</label>
        <input type="text" id="cpf" name="cpf" required maxlength="14" placeholder="ex: 00000000000">
        <span class="error-message" id="errorCpf">Insira somente os números do CPF</span>
        <button type="submit">VERIFICAR</button>
    </form>

    <table id="minhaTabela">
        <thead>
            <tr>
                <th>CPF</th>
                <th>URL</th>
            </tr>
        </thead>
        <tbody>
            <!-- As linhas da tabela serão geradas pelo JavaScript -->
        </tbody>
    </table>

    <script>
        const dados = [
            { cpf: "000.000.000-00", url:"comprovantes/testecomprovante.html" }
        ];

        function formatarCPF(cpf) {
            return cpf.replace(/\D/g, '')
                      .replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/, '$1.$2.$3-$4');
        }

        function criarTabela(dados) {
            const tabela = document.querySelector('#minhaTabela tbody');
            dados.forEach(({cpf, url}) => {
                const linha = tabela.insertRow();
                linha.classList.add('oculto');
                linha.innerHTML = `<td>${cpf}</td><td>${url}</td>`;
            });
        }

        function validarCPF(cpf) {
            return /^\d{11}$/.test(cpf);
        }

        function filtrarTabela(event) {
            event.preventDefault();

            const cpf = document.getElementById('cpf').value.replace(/\D/g, '');
            const linhas = document.querySelectorAll('#minhaTabela tbody tr');
            const errorCpf = document.getElementById('errorCpf');
            let encontrou = false;
            let urlParaRedirecionar = '';

            if (!validarCPF(cpf)) {
                errorCpf.style.display = 'inline';
                return;
            } else {
                errorCpf.style.display = 'none';
            }

            linhas.forEach(linha => {
                const [celulaCpf, celulaUrl] = Array.from(linha.cells).map(cell => cell.textContent.trim());
                const mostrar = (cpf === "" || cpf === celulaCpf.replace(/\D/g, ''));
                
                if (mostrar) {
                    linha.classList.remove('oculto');
                    encontrou = true;
                    urlParaRedirecionar = celulaUrl;
                } else {
                    linha.classList.add('oculto');
                }
            });

            if (encontrou) {
                window.open(urlParaRedirecionar, '_blank');
            } else {
                alert('Não foram encontrados resultados com os parâmetros informados. Favor verificar os dados inseridos e tentar novamente.');
            }

            // Limpa os campos e redefine o foco
            document.getElementById('cpf').value = '';
            document.getElementById('cpf').focus();
        }

        document.getElementById('formFiltro').addEventListener('submit', filtrarTabela);
        document.getElementById('cpf').addEventListener('input', function() {
            this.value = formatarCPF(this.value.replace(/\D/g, '').slice(0, 11));
            const errorCpf = document.getElementById('errorCpf');
            errorCpf.style.display = validarCPF(this.value.replace(/\D/g, '')) ? 'none' : 'inline';
        });

        criarTabela(dados);
    </script>
</body>
</html>
